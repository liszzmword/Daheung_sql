# Business Rules & Assumptions (초안)

이 문서는 세일즈 데이터 분석 및 RAG 답변에서 사용하는 운영 기준/가정을 정리한다.
데이터 해석(특히 기간 비교, 이탈 거래처 산정 등)에서 기준을 명확히 하기 위한 문서이다.

---

## 1. 매출 기준(부가세 포함 여부)

- 기본 매출(권장): supply_amount (부가세 제외)
- 결제액(참고): total_amount (부가세 포함)

원칙(초안):
- 성과 분석/증감률/고객 이탈 분석은 supply_amount를 기본으로 사용한다.
- 단, “청구/결제 금액”에 대한 질문일 때는 total_amount를 사용한다.

> TODO(사용자 확정 필요):
> - 서비스 내 기본 매출 기준을 최종 확정(supply_amount vs total_amount)

---

## 2. 날짜 기준

- sale_date는 거래가 발생한 “매출일”로 간주한다.
- 연도/월 집계는 sale_date 기준으로 수행한다.

주의:
- 회계 마감/정산 반영일이 따로 존재한다면 추가 컬럼 필요

---

## 3. 이탈(Churn) 고객 산정 기준

초안 정의:
- “구매” = 해당 기간 내 revenue > 0인 거래가 1건 이상 존재
- “이탈” = 기준 기간에는 구매가 있으나, 비교 기간에는 구매가 없음

식(개념):
- Churn(A->B) = PurchasedInPeriod(A) AND NOT PurchasedInPeriod(B)

키 기준(중요):
- 가능한 경우 customer_code를 고객 식별 키로 사용 권장
- customer_code의 의미가 “거래처 고유 코드”인지 확인이 필요하다.
  - 만약 거래/주문 코드라면, 고객 식별을 위해 별도 고객 마스터가 필요할 수 있다.

---

## 4. 환불/취소 처리

현재 CSV에는 환불/취소 여부를 나타내는 명시 컬럼이 없다(샘플 기준).

초안 처리:
- 음수 금액(supply_amount < 0 또는 total_amount < 0)이 존재한다면 이를 환불로 간주하고 별도 집계/제외 기준을 둔다.
- 환불 데이터가 별도로 관리된다면, 환불 테이블/컬럼 추가가 필요하다.

> TODO(사용자 확인 필요):
> - 환불/취소 데이터가 CSV에 포함되는지?
> - 포함된다면 표현 방식은 무엇인지? (음수, 별도 코드, 별도 파일 등)

---

## 5. 마진율(margin_rate_pct) 사용 규칙

- margin_rate_pct는 '%' 문자열을 제거하여 숫자로 저장(예: 20% -> 20)
- 초안 해석: 해당 라인아이템의 마진율(%)을 의미한다고 가정

주의:
- 마진율의 산식(원가/매출 기준)이 확정되지 않으면 “정확한 수익성 분석”에 사용을 제한한다.
- 제품(금형비 등) 또는 서비스 항목에서 마진율이 다르게 정의될 수 있다.

---

## 6. 데이터 품질 기본 점검 규칙

권장 체크:
- total_amount = supply_amount + vat 성립 여부 점검
- qty * unit_price = supply_amount 성립 여부 점검(예외 품목 존재 가능)
- customer_name 표기 변동이 있는지 점검(가능하면 customer_code 기준 통합)

---

## 7. 용어 표준

- 거래처 = customer_name
- 담당사원 = sales_rep
- 제품군 = product_group
- 공급가액 = supply_amount (VAT 제외)
- 합계 = total_amount (VAT 포함)

